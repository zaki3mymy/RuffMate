# Ruff Configuration Management Web App - 要件定義書

## プロジェクト概要

Pythonのlintツール「ruff」のルール設定を簡単に管理できるウェブアプリケーションの開発。

### 背景・目的
- ruffには800以上のルールがあり、手動での設定管理が困難
- 基本的にはすべてのルールを有効にしたいが、競合するルールを無効化したいことがある
- 異なるプロジェクトで同じ内容の設定をすることがあるが、なぜ無効となったのかがわからない
- 新たにルールが追加されたりdeprecatedとなることがあり、追従するのが大変

## 機能要件

### 1. データ取得・管理機能
- **データソース**: ruff公式ドキュメント（https://docs.astral.sh/ruff/rules/）
- **取得方式**: ビルド時スクリプトによる公式ドキュメント解析
- **データ埋め込み**: アプリケーションビルド時にルールデータを静的ファイルとして埋め込み
- **更新方式**: アプリケーション再ビルド・再デプロイによる更新
- **データ永続化**: ユーザー設定（ON/OFF、コメント）のみローカルストレージで管理

### 2. ルール管理機能

#### 2.1 ルール表示
- **基本情報表示**: ルールコード、名前、説明、ON/OFF状態
- **詳細情報表示**:
  - コード例・修正例
  - 公式ドキュメントのLegend情報（stable/deprecated/preview、自動修正可否）
- **カテゴリ別表示**: ルールをカテゴリごとにグループ化表示

#### 2.2 ルール操作
- **個別ルール操作**: 各ルールの有効/無効切り替え
- **コメント付与**: 無効化したルールに対する理由コメント追加

#### 2.3 検索・フィルタ機能
- **コード検索**: ルールコードでの検索
- **カテゴリフィルタ**: 特定カテゴリのみの表示

### 3. 設定出力機能

#### 3.1 pyproject.toml生成
- **基本形式**: `select = ["ALL"]` + `ignore = ["ルールコード"]`
- **コメント付与**: 各ignoreルールに理由コメントを自動追加
- **形式例**:
```toml
[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "D203",  # D211 と競合するため除外
    "E501",  # 行長制限をプロジェクト固有に調整
]
```

## 技術要件

### アーキテクチャ
- **構成**: 静的サイト
- **フロントエンドのみ**: バックエンド不要の構成
- **データ処理**: ブラウザ内での設定処理・保存
- **ビルド時スクリプト**: ruffルールデータを取得しアセットに追加する

### 技術スタック
- **Core Framework**: React 18 + TypeScript
- **ビルドツール**: Vite
- **状態管理**: Zustand（軽量で直感的）
- **UIライブラリ**: Material-UI v5
- **テストフレームワーク**:
  - ユニット：Vitest + Testing Library
  - E2E：Playwright
- **コード品質**: ESLint + Prettier
- **型安全性**: TypeScript strict mode

### パフォーマンス要件
- **大量データ対応**: 800+ルールの効率的表示
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップ全対応
- **初期読み込み**: 3秒以内での初期表示完了

## 品質要件

### テスト要件
- **カバレッジ目標**: 100%（全関数・分岐・条件を網羅）
- **テスト種別**:
  - ユニットテスト：全サービス・コンポーネント・ユーティリティ
  - 結合テスト：状態管理・データフロー
  - E2Eテスト：主要ユーザーシナリオ
- **テスト自動化**: CI/CDパイプラインでの自動実行

### コード品質
- **型安全性**: TypeScript strict mode でのエラーゼロ
- **Linting**: ESLint ルールの完全遵守
- **Formatting**: Prettier による統一フォーマット
- **依存関係**: 脆弱性のない最新パッケージの使用

## デプロイ・運用要件

### デプロイ方式（複数対応）
1. **静的ホスティング**: Netlify、Vercel、GitHub Pages
2. **ローカル実行**: `npm run dev` による開発環境
3. **Dockerコンテナ**: ポータブルな実行環境

### 運用要件
- **更新容易性**: ruffルールの新規追加・変更への対応（ビルド時自動取得）
- **設定互換性**: 異なるruffバージョンでの設定互換性維持
- **ビルドプロセス**: CI/CD環境でのルールデータ自動更新・ビルド・デプロイ

## ユーザビリティ要件

### 使いやすさ
- **直感的UI**: ルールのオンオフ状態が視覚的に分かりやすい
- **効率的操作**: 大量ルールの快適な閲覧・操作
- **学習コストの低さ**: ルールの例示

### アクセシビリティ
- **キーボードナビゲーション**: マウス不要での全操作
- **スクリーンリーダー対応**: ARIA属性の適切な実装
- **色覚多様性**: 色情報に依存しない情報伝達

## 制約事項

### 技術制約
- **ビルド時制約**: ルールデータ更新にはビルド・デプロイが必要
- **ローカルストレージ限界**: ユーザー設定データの効率的保存
- **ブラウザ互換性**: モダンブラウザ対応（IE非対応）

### 運用制約
- **データ更新制限**: ルールデータ更新にはアプリケーション再デプロイが必要
- **更新頻度**: ビルド・デプロイサイクルに依存
- **ビルド環境依存**: データ取得にはビルド時のインターネット接続が必須
- **バックアップなし**: ユーザー設定はローカルストレージのみ

## 成功指標

### 機能指標
- **ビルド時データ取得成功率**: 100%（ビルド失敗時は適切なエラー処理）
- **ルール表示完了時間**: 3秒以内
- **設定出力精度**: 100%（構文エラーなし）

### 品質指標
- **テストカバレッジ**: 100%
- **TypeScriptエラー**: 0件
- **Lintingエラー**: 0件
- **E2Eテスト成功率**: 100%

## リリース戦略

### フェーズ0: Ruffルールの取得
- ruffの公式ドキュメントを取得
- 取得したドキュメントからルールのJSONファイルを作成
- ビルド時に上記の処理を実行しアセットに組み込む

### フェーズ1: MVP版（最小機能版）
- 基本的なルール表示・ON/OFF切り替え
- シンプルなpyproject.toml出力
- ローカルストレージでの設定保存

### フェーズ2: 標準版
- 検索・フィルタ機能
- カテゴリ別管理
- UI改善・仮想スクロール対応

### フェーズ3: 完全版
- 詳細表示・Legend情報
- 設定テンプレート機能
- 包括的なテスト・Docker対応

---

## 補足情報

### ruffについて
- **ルール総数**: 800以上
- **ルール形式**: コード（例：E501）+ 名前 + 詳細説明
- **メタデータ**: 安定性（stable/deprecated/preview）、自動修正可否

### 参考リンク
- [Ruff公式ドキュメント](https://docs.astral.sh/ruff/rules/)
- [Ruff GitHub リポジトリ](https://github.com/astral-sh/ruff)
- [pyproject.toml 設定リファレンス](https://docs.astral.sh/ruff/configuration/)
