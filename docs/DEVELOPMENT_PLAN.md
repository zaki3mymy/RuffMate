# Ruff Configuration Manager - 開発計画書

## プロジェクト概要

段階的アプローチによる Ruff 設定管理ウェブアプリケーションの開発計画。
MVP版から開始し、機能を段階的に追加して完全版まで構築する。

### 成果物
- **MVP版**: 基本的なルール表示・設定・出力機能
- **標準版**: 検索・フィルタ・カテゴリ管理機能
- **完全版**: 詳細表示・テンプレート・包括的テスト

## フェーズ別開発計画

### フェーズ1: 環境構築・基盤開発

**目標**: 開発環境の完全セットアップと型基盤の構築
**必須要件**: テストカバレッジ100%達成

#### 1.1 プロジェクト初期化
- [ ] Vite + React + TypeScript プロジェクト作成
```bash
npm create vite@latest ruff-config-manager -- --template react-ts
```
- [ ] 必要パッケージのインストール
  - UI: `@mui/material`, `@emotion/react`, `@emotion/styled`
  - 状態管理: `zustand`, `immer`
  - データフェッチ: `@tanstack/react-query`
  - ユーティリティ: `@tanstack/react-virtual`, `use-debounce`
- [ ] 開発ツールのセットアップ
  - テスト: `vitest`, `@testing-library/react`, `@testing-library/jest-dom`
  - E2E: `@playwright/test`
  - Linting: `@typescript-eslint/parser`, `@typescript-eslint/eslint-plugin`
  - フォーマット: `prettier`
  - 自動チェック(Lint / フォーマット): `husky`

#### 1.2 プロジェクト構成作成
- [ ] ディレクトリ構成の構築（`src/components/`, `src/services/`, `src/store/`, `src/types/`, `scripts/`等）
- [ ] 基本的な設定ファイル作成
  - `tsconfig.json` (strict mode有効化)
  - `vite.config.ts` (静的アセット設定)
  - `eslint.config.js`
  - `prettier.config.js`
  - `vitest.config.ts`
  - `playwright.config.ts`

#### 1.3 ビルドスクリプト基盤（テスト駆動開発）
- [ ] **テストファースト**: ビルドスクリプトのテストコードを先に作成
- [ ] **`scripts/fetchRuffData.ts`**: TypeScriptによる型安全なデータ取得スクリプト
- [ ] **`scripts/parseRuffData.ts`**: TypeScriptによる型安全なHTMLパース・JSON変換
- [ ] **`scripts/validateData.ts`**: TypeScriptによる型安全なデータ検証スクリプト
- [ ] **`package.json`**: ビルドスクリプトの統合（prebuild hooks等）
- [ ] **カバレッジ100%確保**: 全ビルドスクリプトの完全テスト

#### 1.4 型定義・基盤コード
- [ ] **`src/types/ruffTypes.ts`**: RuffRule、RuffCategory、FilterOptions等の型定義
- [ ] **`src/types/configTypes.ts`**: 設定出力関連の型定義
- [ ] **`src/utils/constants.ts`**: 定数定義（デフォルト値、UI設定等）
- [ ] MUI テーマ設定（`src/styles/theme.ts`）
- [ ] 基本的なレイアウトコンポーネント（Header、Footer、Layout）

#### 1.5 品質・テスト環境
- [ ] ESLint + Prettier 設定と動作確認
- [ ] huskyによるコミット時の自動 Lint / Format
- [ ] Vitest セットアップとサンプルテスト作成
- [ ] Playwright E2E環境セットアップ
- [ ] GitHub Actions ワークフロー作成（CI/CD）

---

### フェーズ2: MVP版実装

**目標**: 最小限の機能で動作するアプリケーション完成
**必須要件**: テストカバレッジ100%達成、テスト駆動開発（TDD）

#### 2.1 ビルドスクリプト実装（テスト駆動開発）
- [ ] **テストコード優先作成**: 全ビルドスクリプトのテストを先に実装
- [ ] **`scripts/fetchRuffData.ts`** 詳細実装
  - TypeScript型安全なruff公式ドキュメント取得
  - エラーハンドリング・リトライ機構
  - タイムアウト・レート制限対応
- [ ] **`scripts/parseRuffData.ts`** 詳細実装
  - TypeScript型安全なHTMLパース・ルール情報抽出
  - 厳密な型定義によるJSON形式変換・構造化
  - データバリデーション・サニタイゼーション
- [ ] **ビルドスクリプト統合**
  - package.json の prebuild hooks設定
  - データ生成 → ビルド の自動化
- [ ] **カバレッジ100%確保**: 全分岐・条件・関数のテスト
- [ ] モックデータの作成（開発・テスト用）

#### 2.2 静的データローダー（テスト駆動開発）
- [ ] **テストコード優先作成**: dataLoader関連のテストを先に実装
- [ ] **`src/services/dataLoader.ts`** 実装
  - 埋め込み静的データの型安全な読み込み
  - データ形式のバリデーション
  - TypeScript厳密型チェックによるデータアクセス
- [ ] **カバレッジ100%確保**: 全関数・エラーケースのテスト

#### 2.3 状態管理実装（テスト駆動開発）
- [ ] **テストコード優先作成**: 状態管理のテストを先に実装
- [ ] **`src/store/rulesStore.ts`** 実装
  - TypeScript厳密型による Zustand + Immer 状態管理
  - ルール一覧の型安全な管理
  - LocalStorage 永続化対応
  - 基本的なフィルタリング機能
- [ ] **`src/store/uiStore.ts`** 実装
  - UI状態管理（ローディング、エラー、選択状態等）
- [ ] **カバレッジ100%確保**: 全状態更新・副作用のテスト

#### 2.4 基本UIコンポーネント（テスト駆動開発）
- [ ] **テストコード優先作成**: 全UIコンポーネントのテストを先に実装
- [ ] **`src/components/rules/RuleManager.tsx`**
  - ルール一覧表示（シンプルなリスト形式）
  - ルール ON/OFF 切り替え機能
  - 基本的なエラー表示（データローディングエラー不要）
- [ ] **`src/components/rules/RuleCard.tsx`**
  - 個別ルール表示コンポーネント
  - スイッチによる有効/無効切り替え
  - 基本情報表示（コード、名前、説明）
- [ ] **`src/components/common/Header.tsx`**
  - アプリケーション ヘッダー
  - アプリ情報表示（ruffバージョン等）
- [ ] **カバレッジ100%確保**: 全プロパティ・イベント・レンダリングパターンのテスト

#### 2.5 設定出力機能（テスト駆動開発）
- [ ] **テストコード優先作成**: 設定出力機能のテストを先に実装
- [ ] **`src/services/configGenerator.ts`** 実装
  - TypeScript型安全なpyproject.toml生成機能
  - コメント付き ignore リスト作成
  - 基本的なバリデーション機能
- [ ] **`src/components/config/ConfigExporter.tsx`**
  - 設定出力 UI
  - コピー・ダウンロード機能
  - プレビュー表示
- [ ] **カバレッジ100%確保**: 全出力パターン・エラーケースのテスト

#### 2.6 統合・動作確認
- [ ] 静的データ読み込みからUI表示までの統合テスト
- [ ] LocalStorage での設定永続化テスト
- [ ] 基本的な E2E テスト作成（ルール切り替え・設定出力）
- [ ] レスポンシブデザインの基本対応
- [ ] ビルドプロセスの動作確認（データ取得→ビルド→デプロイ）

---

### フェーズ3: 標準版機能追加

**目標**: 実用的な機能を備えた標準版完成
**必須要件**: テストカバレッジ100%達成、テスト駆動開発（TDD）

#### 3.1 検索・フィルタ機能（テスト駆動開発）
- [ ] **テストコード優先作成**: 検索・フィルタ機能のテストを先に実装
- [ ] **`src/components/search/SearchBar.tsx`** 実装
  - TypeScript型安全なリアルタイム検索（デバウンス対応）
  - ルールコード・名前・説明での検索
  - 検索履歴機能
- [ ] **`src/components/search/FilterPanel.tsx`** 実装
  - 状態フィルタ（enabled/disabled）
  - Legendフィルタ（stable/deprecated/preview）
  - カテゴリフィルタ
  - 複数条件の組み合わせフィルタ
- [ ] **`src/hooks/useFilteredRules.ts`** カスタムフック
  - 検索・フィルタロジックの抽象化
  - パフォーマンス最適化（useMemo使用）
- [ ] **カバレッジ100%確保**: 全検索パターン・フィルタ組み合わせのテスト

#### 3.2 カテゴリ管理機能（テスト駆動開発）
- [ ] **テストコード優先作成**: カテゴリ管理のテストを先に実装
- [ ] **`src/components/rules/CategoryPanel.tsx`** 実装
  - カテゴリ別ルール表示
  - カテゴリ一括 ON/OFF 機能
  - カテゴリ統計表示（enabled/total）
- [ ] カテゴリ情報の動的生成ロジック
- [ ] **カバレッジ100%確保**: 全カテゴリ操作・状態変更のテスト

#### 3.3 UI改善・仮想スクロール（テスト駆動開発）
- [ ] **テストコード優先作成**: UI改善・仮想スクロールのテストを先に実装
- [ ] **仮想スクロール実装**
  - `@tanstack/react-virtual` 導入
  - 800+ルールの効率的レンダリング
  - スクロール位置の保持機能
- [ ] **Material-UI 本格導入**
  - 統一されたデザインシステム適用
  - ダークモード対応
  - アニメーション・トランジション追加
- [ ] **レスポンシブデザイン完全対応**
  - モバイル・タブレット・デスクトップ対応
  - ブレークポイント別レイアウト
  - タッチフレンドリーな操作感
- [ ] **カバレッジ100%確保**: 全デバイス・解像度での動作テスト

#### 3.4 パフォーマンス最適化（テスト駆動開発）
- [ ] **テストコード優先作成**: パフォーマンス最適化のテストを先に実装
- [ ] React.memo による不要な再レンダリング防止
- [ ] useMemo/useCallback の適切な使用
- [ ] コード分割（lazy loading）の導入
- [ ] バンドルサイズ最適化
- [ ] **カバレッジ100%確保**: 全最適化ケース・パフォーマンス条件のテスト

#### 3.5 エラーハンドリング強化（テスト駆動開発）
- [ ] **テストコード優先作成**: エラーハンドリングのテストを先に実装
- [ ] **`src/components/common/ErrorBoundary.tsx`** 実装
- [ ] グローバルエラーハンドリング
- [ ] ユーザーフレンドリーなエラーメッセージ
- [ ] オフライン対応・フォールバック機能
- [ ] **カバレッジ100%確保**: 全エラーケース・復旧シナリオのテスト

---

### フェーズ4: 完全版・品質向上

**目標**: プロダクションレディな完全版アプリケーション
**必須要件**: テストカバレッジ100%達成、テスト駆動開発（TDD）

#### 4.1 詳細表示・Legend情報（テスト駆動開発）
- [ ] **テストコード優先作成**: 詳細表示・Legend情報のテストを先に実装
- [ ] **`src/components/rules/RuleDetailModal.tsx`** 実装
  - ルールの詳細情報表示
  - コード例・修正例の表示
  - 公式ドキュメントリンク
- [ ] **Legend情報の完全対応**
  - stable/deprecated/preview 表示
  - 自動修正可否の表示
  - エコシステム固有ルールの表示
- [ ] アクセシビリティ完全対応
  - ARIA属性の適切な実装
  - キーボードナビゲーション
  - スクリーンリーダー対応
- [ ] **カバレッジ100%確保**: 全表示パターン・アクセシビリティ条件のテスト

#### 4.2 設定テンプレート機能（テスト駆動開発）
- [ ] **テストコード優先作成**: 設定テンプレート機能のテストを先に実装
- [ ] **プリセットテンプレート**
  - Web開発用設定
  - データ分析用設定
  - ライブラリ開発用設定
  - 学習・教育用設定
- [ ] **カスタムテンプレート**
  - ユーザー定義テンプレートの作成・保存
  - テンプレートの共有・エクスポート機能
  - テンプレート適用・インポート機能
- [ ] **カバレッジ100%確保**: 全テンプレート・設定組み合わせのテスト

#### 4.3 包括的テスト実装（100%カバレッジ必須達成）
- [ ] **ユニットテスト完全実装**
  - 全サービス・ユーティリティ関数
  - 全カスタムフック
  - 全状態管理ロジック
  - 全ビルドスクリプト（TypeScript）
- [ ] **コンポーネントテスト完全実装**
  - 全UIコンポーネント
  - ユーザーインタラクション
  - エラー状態・エッジケース
- [ ] **統合テスト実装**
  - データフロー全体
  - 状態管理の統合
  - LocalStorage連携
  - ビルドプロセス統合
- [ ] **E2Eテスト実装**
  - 主要ユーザーシナリオ
  - クロスブラウザテスト
  - パフォーマンステスト
- [ ] **カバレッジ100%最終確認**: 全関数・分岐・条件・行の完全テスト

#### 4.4 デプロイメント・運用準備（テスト駆動開発）
- [ ] **テストコード優先作成**: デプロイメント・CI/CDのテストを先に実装
- [ ] **ビルド時データ取得の CI/CD統合**
  - ビルド環境でのインターネット接続設定
  - データ取得失敗時のビルド中断・通知設定
  - 定期的なデータ更新・自動リビルド設定
- [ ] **Docker設定**
  - マルチステージビルド（データ取得→ビルド→本番）
  - ビルド時の外部アクセス権限設定
  - セキュリティ強化（非rootユーザー）
  - ヘルスチェック設定
- [ ] **静的ホスティング対応**
  - 完全静的配信設定（外部API依存なし）
  - GitHub Pages / Netlify / Vercel 設定
  - 相対パス・ルーティング対応
  - 高効率キャッシュ設定（静的アセット）
- [ ] **CI/CDパイプライン完成**
  - ビルド時データ取得の自動実行
  - データ取得エラー時のフォールバック
  - 自動テスト実行
  - 自動デプロイ
  - セキュリティチェック（依存関係脆弱性）
- [ ] **プロダクション最適化**
  - バンドル最適化（静的データ含む）
  - 静的ファイルキャッシュ戦略
  - CDN配信最適化
  - パフォーマンス監視設定
- [ ] **カバレッジ100%確保**: 全デプロイプロセス・設定パターンのテスト

#### 4.5 ドキュメント・保守性（テスト駆動開発）
- [ ] **テストコード優先作成**: ドキュメント生成のテストを先に実装
- [ ] **技術ドキュメント充実**
  - API仕様書
  - コンポーネントカタログ（Storybook）
  - 開発者向けREADME
- [ ] **ユーザー向けドキュメント**
  - 使用方法ガイド
  - FAQ・トラブルシューティング
  - 設定例集
- [ ] **カバレッジ100%確保**: 全ドキュメント生成・更新プロセスのテスト

---

## 品質保証計画

### テストカバレッジ目標: 100%

#### カバレッジ対象
- **関数カバレッジ**: 全関数の実行
- **分岐カバレッジ**: 全if文、三項演算子等の分岐
- **条件カバレッジ**: 全条件式のtrue/false
- **行カバレッジ**: 全実行可能行

#### テスト戦略
- **ユニットテスト**: 各関数・モジュールの独立テスト
- **コンポーネントテスト**: UIコンポーネントの動作テスト
- **統合テスト**: モジュール間連携のテスト
- **E2Eテスト**: エンドユーザー視点のシナリオテスト

### 品質チェック項目
- [ ] TypeScript strict mode エラーゼロ
- [ ] ESLint警告・エラーゼロ
- [ ] Prettier フォーマット統一
- [ ] 全テストパス（ユニット・統合・E2E）
- [ ] パフォーマンス要件達成（初期表示3秒以内）
- [ ] アクセシビリティ要件達成（WCAG 2.1 AA準拠）
- [ ] セキュリティ要件達成（脆弱性スキャン通過）

---

## リスク管理・対応策

### 技術リスク

#### 1. ビルド時データ取得依存（ruff公式ドキュメント）
**リスク**: サイト構造変更、ビルド時ネットワーク障害、データ取得失敗
**対応策**:
- ビルド時のエラーハンドリング・リトライ機構
- CI/CD環境での安定したネットワーク設定
- データ取得失敗時のフォールバックデータ準備
- 定期的な自動ビルド・データ更新

#### 2. パフォーマンス問題（800+ルール表示）
**リスク**: ブラウザフリーズ、メモリ使用量過多
**対応策**:
- 仮想スクロール必須実装
- メモ化戦略の徹底
- プロファイリングによる最適化

#### 3. データ更新のタイムラグ
**リスク**: ruff新バージョンリリース時の即座な対応不可
**対応策**:
- 定期的な自動ビルド・デプロイ設定
- ruffリリース通知の監視・自動対応
- 手動での緊急更新プロセス整備

#### 4. ビルド環境依存
**リスク**: CI/CD環境でのビルド失敗、環境差異
**対応策**:
- Docker化によるビルド環境統一
- 複数CI/CD環境での冗長化（GitHub Actions + 他）
- ローカル環境でのビルド再現性確保

### プロジェクトリスク

#### 1. 開発期間の延長
**対応策**: MVP優先、段階的リリース

#### 2. 品質要件（100%カバレッジ）の達成困難
**対応策**: テスト駆動開発、継続的な品質監視

#### 3. ユーザビリティ問題
**対応策**: 早期プロトタイプテスト、ユーザーフィードバック収集

---

## 成果物・デリバラブル

### フェーズごと成果物

#### フェーズ1
- [ ] プロジェクト環境（package.json, 設定ファイル）
- [ ] 型定義ファイル（ruffTypes.ts, configTypes.ts）
- [ ] 基本テスト環境
- [ ] CI/CD パイプライン基盤

#### フェーズ2（MVP）
- [ ] 動作するウェブアプリケーション
- [ ] 基本機能（ルール表示・設定・出力）
- [ ] ユニットテスト（主要機能）
- [ ] デプロイ可能なビルド

#### フェーズ3（標準版）
- [ ] 検索・フィルタ機能付きアプリケーション
- [ ] レスポンシブデザイン対応
- [ ] パフォーマンス最適化済み
- [ ] 統合テスト完備

#### フェーズ4（完全版）
- [ ] 完全機能アプリケーション
- [ ] 100%テストカバレッジ
- [ ] 本番デプロイメント対応
- [ ] ドキュメント完備

### 最終成果物
- [ ] **Ruff Configuration Manager アプリケーション**
- [ ] **ビルド時データ取得スクリプト群**（fetchRuffData.js、parseRuffData.js 等）
- [ ] **完全なテストスイート**（ユニット・統合・E2E・ビルドスクリプト）
- [ ] **Docker イメージ**（ビルド時データ取得対応）
- [ ] **CI/CDパイプライン**（自動データ更新・ビルド・デプロイ）
- [ ] **デプロイメント設定**（GitHub Pages, Netlify, Docker）
- [ ] **技術ドキュメント一式**
- [ ] **ユーザーガイド**

---

## 開発環境・ツール要件

### 必須環境
- **Node.js**: v18以上
- **npm**: v9以上
- **Git**: バージョン管理
- **モダンブラウザ**: Chrome, Firefox, Safari, Edge

### ビルド環境要件
- **インターネット接続**: ビルド時のruff公式ドキュメント取得に必須
- **CI/CD環境**: GitHub Actions、Netlify、Vercel 等でのビルド実行
- **外部アクセス権限**: https://docs.astral.sh へのHTTPS接続権限
- **タイムアウト設定**: ビルド時間延長対応（データ取得込みで5-10分）

### 推奨開発ツール
- **エディタ**: VS Code（TypeScript、ESLint、Prettier拡張）
- **デバッグ**: Chrome DevTools、React DevTools
- **テスト**: Vitest UI、Playwright Test Results
- **デプロイ**: Docker Desktop（ローカルテスト用）

### 品質・監視ツール
- **Code Coverage**: c8 (Vitest integrated)
- **Bundle Analyzer**: rollup-plugin-visualizer
- **Performance**: Lighthouse、Web Vitals
- **Security**: npm audit、Snyk

この開発計画に従って、高品質で実用的なRuff設定管理アプリケーションを段階的に構築していきます。
